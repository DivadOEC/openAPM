<map version="0.9.0">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node CREATED="1367559625599" ID="ID_819776767" MODIFIED="1367574207420" TEXT="openAPM&#x7cfb;&#x7edf;&#x548c;&#x6a21;&#x5757;&#x521d;&#x59cb;&#x5316;&#x6d41;&#x7a0b;&#x5206;&#x6790;">
<node CREATED="1367564366315" ID="ID_203333878" MODIFIED="1367564429296" POSITION="right" TEXT="&#x58f0;&#x660e;&#x5bf9;&#x8c61;&#x65f6;&#x7684;&#x7c7b;&#x7684;&#x6784;&#x9020;&#x8c03;&#x7528;"/>
<node CREATED="1367564435754" ID="ID_1839116398" MODIFIED="1367564507958" POSITION="right" TEXT="HAL&#x786c;&#x4ef6;&#x62bd;&#x8c61;&#x5c42;&#x7684;&#x82af;&#x7247;&#x7ea7;&#x521d;&#x59cb;&#x5316;"/>
<node CREATED="1367564510175" ID="ID_628148016" MODIFIED="1367564527101" POSITION="right" TEXT="const AP_HAL::HAL&amp; hal = AP_HAL_BOARD_DRIVER;"/>
<node CREATED="1367564731725" ID="ID_988131765" MODIFIED="1367564938285" POSITION="right" TEXT="&#x5177;&#x4f53;&#x6307;&#x5411;:"/>
<node CREATED="1367564752716" ID="ID_550695693" MODIFIED="1367564777804" POSITION="right" TEXT="#elif CONFIG_HAL_BOARD == HAL_BOARD_APM2 &#xa;#define AP_HAL_BOARD_DRIVER     AP_HAL_AVR_APM2 "/>
<node CREATED="1367564800909" ID="ID_1024292846" MODIFIED="1367565802320" POSITION="right" TEXT="&#x800c;,"/>
<node CREATED="1367564807531" ID="ID_195013917" MODIFIED="1367564824081" POSITION="right" TEXT="const HAL_AVR_APM2 AP_HAL_AVR_APM2;"/>
<node CREATED="1367564835752" ID="ID_1542042646" MODIFIED="1367564934887" POSITION="right" TEXT="&#x6240;&#x4ee5;&#x7ee7;&#x7eed;&#x67e5;&#x627e;HAL_AVR_APM2:"/>
<node CREATED="1367564873882" ID="ID_1041726386" MODIFIED="1367565645776" POSITION="right" TEXT="class HAL_AVR_APM2 : public AP_HAL::HAL { &#xa;&#x9;public:     HAL_AVR_APM2();     &#xa;&#x9;void init(int argc, char * const argv[]) const;&#xa; }; "/>
<node CREATED="1367565647806" ID="ID_562781017" MODIFIED="1367565668898" POSITION="right" TEXT="HAL_AVR_APM2&#x662f;&#x6784;&#x9020;&#x51fd;&#x6570;&#xff1a;"/>
<node CREATED="1367565669572" ID="ID_931213265" MODIFIED="1367565680020" POSITION="right" TEXT="HAL_AVR_APM2::HAL_AVR_APM2() :&#xa;    AP_HAL::HAL(&#xa;        &amp;avrUart0Driver, /* phys UART0 -&gt; uartA */&#xa;        &amp;avrUart1Driver, /* phys UART1 -&gt; uartB */&#xa;        &amp;avrUart2Driver, /* phys UART2 -&gt; uartC */&#xa;        &amp;avrI2CDriver,&#xa;        &amp;apm2SPIDriver,&#xa;        &amp;avrAnalogIn,&#xa;        &amp;avrEEPROMStorage,&#xa;        &amp;consoleDriver,&#xa;        &amp;avrGPIO,&#xa;        &amp;apm2RCInput,&#xa;        &amp;apm2RCOutput,&#xa;        &amp;avrScheduler,&#xa;        &amp;avrUtil )&#xa;{}&#xa;"/>
<node CREATED="1367565697728" ID="ID_120064914" MODIFIED="1367565751989" POSITION="right" TEXT="&#x4e0a;&#x9762;&#x662f;&#x58f0;&#x660e;&#x4e86;&#x5404;&#x79cd;&#x82af;&#x7247;&#x8d44;&#x6e90;&#xff0c;&#x7c7b;&#x4f3c;&#x4e00;&#x79cd;&#x7ec4;&#x5408;&#xff0c;&#x5c06;&#x5c5e;&#x4e8e;APM2&#x7684;&#x82af;&#x7247;&#x7ea7;&#x8d44;&#x6e90;&#x52a0;&#x8f7d;&#x8fdb;&#x6765;&#xff1a;"/>
<node CREATED="1367565752936" ID="ID_313660259" MODIFIED="1367565788414" POSITION="right" TEXT="static AVRSemaphore     i2cSemaphore;&#xa;static AVRI2CDriver     avrI2CDriver(&amp;i2cSemaphore);&#xa;static APM2SPIDeviceManager apm2SPIDriver;&#xa;static AVRAnalogIn      avrAnalogIn;&#xa;static AVREEPROMStorage avrEEPROMStorage;&#xa;static AVRConsoleDriver consoleDriver;&#xa;static AVRGPIO          avrGPIO;&#xa;static APM2RCInput      apm2RCInput;&#xa;static APM2RCOutput     apm2RCOutput;&#xa;static AVRScheduler     avrScheduler;&#xa;static AVRUtil          avrUtil;&#xa;"/>
<node CREATED="1367565771478" ID="ID_1259096643" MODIFIED="1367565890365" POSITION="right" TEXT="&#x540c;&#x7406;&#xff0c;&#x8fd8;&#x6709;&#x8fd9;&#x4e9b;&#x58f0;&#x660e;&#x5e26;&#x6765;&#x7684;&#x6784;&#x9020;&#xff1a;"/>
<node CREATED="1367565892416" ID="ID_1846498060" MODIFIED="1367565903695" POSITION="right" TEXT="AP_HAL::BetterStream* cliSerial; //&#x4e00;&#x4e2a;&#x6d41;&#x4f5c;&#x4e3a;&#x547d;&#x4ee4;&#x884c;&#x63a5;&#x53e3;&#x7684;&#x4e32;&#x53e3;&#xff0c;&#x5b9e;&#x4f8b;"/>
<node CREATED="1367566152252" ID="ID_1752741667" MODIFIED="1367566155042" POSITION="right" TEXT="APM_OBC obc;//&#x58f0;&#x660e;&#x5931;&#x6548;&#x4fdd;&#x62a4;&#x5bf9;&#x8c61; "/>
<node CREATED="1367566427327" ID="ID_173601982" MODIFIED="1367566544476" POSITION="right" TEXT="DataFlash_APM2 DataFlash; //&#x58f0;&#x660e;Flash&#x5bf9;&#x8c61;"/>
<node CREATED="1367567521251" ID="ID_266622511" MODIFIED="1367567534810" POSITION="right" TEXT="static GPS         *g_gps;//&#x58f0;&#x660e;GPS&#x5bf9;&#x8c61;"/>
<node CREATED="1367567560467" ID="ID_472206099" MODIFIED="1367567571490" POSITION="right" TEXT="static AP_ADC_ADS7844 adc;//&#x58f0;&#x660e;ADC&#x5bf9;&#x8c61;"/>
<node CREATED="1367567712732" ID="ID_54382791" MODIFIED="1367567728410" POSITION="right" TEXT="AP_InertialSensor_MPU6000 ins; //&#x58f0;&#x660e;&#x60ef;&#x6027;&#x5bfc;&#x822a;&#x6a21;&#x5757;"/>
<node CREATED="1367567884719" ID="ID_92016151" MODIFIED="1367567925389" POSITION="right" TEXT="AP_AHRS_DCM ahrs(&amp;ins, g_gps);// &#x58f0;&#x660e;AHRS&#x7684;DCM&#x7b97;&#x6cd5;&#xff0c;&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x9700;&#x8981;&#x60ef;&#x6027;&#x5355;&#x5143;&#x548c;GPS "/>
<node CREATED="1367567947314" ID="ID_1832086447" MODIFIED="1367567976677" POSITION="right" TEXT=" GCS_MAVLINK gcs0; GCS_MAVLINK gcs3; // &#x58f0;&#x660e;&#x5730;&#x9762;&#x7ad9;&#x5bf9;&#x8c61;"/>
<node CREATED="1367568062948" ID="ID_732812369" MODIFIED="1367568070489" POSITION="right" TEXT="// &#x58f0;&#x660e;ADC&#x8f93;&#x5165;&#x6e90;&#x5bf9;&#x8c61;&#xa;AP_HAL::AnalogSource *pitot_analog_source;&#xa;    &#xa;// a pin for reading the receiver RSSI voltage. The scaling by 0.25&#xa;// is to take the 0 to 1024 range down to an 8 bit range for MAVLink&#xa;AP_HAL::AnalogSource *rssi_analog_source;&#xa;&#xa;AP_HAL::AnalogSource *vcc_pin;&#xa;    &#xa;AP_HAL::AnalogSource * batt_volt_pin;&#xa;AP_HAL::AnalogSource * batt_curr_pin;&#xa;"/>
<node CREATED="1367568144627" ID="ID_118531945" MODIFIED="1367568146787" POSITION="right" TEXT="..."/>
<node CREATED="1367574212735" ID="ID_1901395273" MODIFIED="1367574238108" POSITION="left" TEXT="&#x9876;&#x5c42;&#x903b;&#x8f91;&#x4e2d;&#x7684;&#x521d;&#x59cb;&#x5316;"/>
<node CREATED="1367574240022" ID="ID_869718650" MODIFIED="1367574270267" POSITION="left" TEXT="// &#xff1f;&#x8f7d;&#x5165;&#x6765;&#x81ea;EEPROM&#x7684;1028&#x4e2a;&#x5b57;&#x8282;,1028&#x4e2a;&#x5b57;&#x8282;&#x4e4b;&#x540e;&#x90fd;&#x662f;&#x653e;&#x7f6e;&#x822a;&#x70b9;&#x4fe1;&#x606f;&#xff1f;&#xa;// &#x8be5;&#x51fd;&#x6570;&#x7ee7;&#x627f;AP_Param&#x7c7b;&#x4e0b;&#x7684;AP_Param()&#x51fd;&#x6570;,&#x8f7d;&#x5165;&#x5230;_var_info&#x4e2d;&#xa;AP_Param param_loader(var_info, WP_START_BYTE);&#xa;"/>
<node CREATED="1367574321161" ID="ID_624237039" MODIFIED="1367574330640" POSITION="left" TEXT="// &#x8bbe;&#x7f6e;ADC&#x7684;&#x8f93;&#x5165;&#x6e90;&#xff0c;&#x5e76;&#x8bbe;&#x7f6e;&#x5176;&#x5206;&#x9891;&#xa;    rssi_analog_source = hal.analogin-&gt;channel(ANALOG_INPUT_NONE, 0.25);&#xa;&#xa;#if CONFIG_PITOT_SOURCE == PITOT_SOURCE_ADC&#xa;    pitot_analog_source = new AP_ADC_AnalogSource( &amp;adc,&#xa;                                         CONFIG_PITOT_SOURCE_ADC_CHANNEL, 1.0);&#xa;#elif CONFIG_PITOT_SOURCE == PITOT_SOURCE_ANALOG_PIN&#xa;    pitot_analog_source = hal.analogin-&gt;channel(CONFIG_PITOT_SOURCE_ANALOG_PIN, 4.0);&#xa;#endif&#xa;    vcc_pin = hal.analogin-&gt;channel(ANALOG_INPUT_BOARD_VCC);&#xa;&#xa;    batt_volt_pin = hal.analogin-&gt;channel(g.battery_volt_pin);&#xa;    batt_curr_pin = hal.analogin-&gt;channel(g.battery_curr_pin);&#xa;"/>
<node CREATED="1367574447771" ID="ID_989389847" MODIFIED="1367574450255" POSITION="left" TEXT="airspeed.init(pitot_analog_source);//&#x7a7a;&#x901f;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x53c2;&#x8003;AP_Airspeed.h "/>
<node CREATED="1367574451698" ID="ID_137809897" MODIFIED="1367574471383" POSITION="left" TEXT="memcheck_init();//&#x521d;&#x59cb;&#x5316;&#x8bca;&#x65ad;&#x5185;&#x5b58;&#xff0c;&#x8bbe;&#x7f6e;&#x6807;&#x5fd7;&#x4f4d; "/>
<node CREATED="1367574482938" ID="ID_538986995" MODIFIED="1367574484869" POSITION="left" TEXT="init_ardupilot();//&#x5269;&#x4f59;&#x5176;&#x4ed6;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x53c2;&#x8003;system.pde">
<node CREATED="1367574490200" ID="ID_323954284" MODIFIED="1367583651166" TEXT="&#x5224;&#x65ad;UART0&#x662f;&#x5426;&#x7528;&#x4f5c;USB"/>
<node CREATED="1367583652549" ID="ID_430880020" MODIFIED="1367583674547" TEXT="#if USB_MUX_PIN &gt; 0&#xa;    // on the APM2 board we have a mux thet switches UART0 between&#xa;    // USB and the board header. If the right ArduPPM firmware is&#xa;    // installed we can detect if USB is connected using the&#xa;    // USB_MUX_PIN&#xa;"/>
<node CREATED="1367583682976" ID="ID_486835687" MODIFIED="1367583765538" TEXT="&#x521d;&#x59cb;&#x5316;UART0&#xff08;UARTA&#xff09;&#xff0c;&#x6b64;&#x65f6;&#x662f;&#x4f5c;&#x4e3a;USB&#x53e3;&#x7684;"/>
<node CREATED="1367583778451" ID="ID_1432885124" MODIFIED="1367583784023" TEXT="    // Console serial port&#xa;    //&#xa;    // The console port buffers are defined to be sufficiently large to support&#xa;    // the MAVLink protocol efficiently&#xa;    //&#xa;    hal.uartA-&gt;begin(SERIAL0_BAUD, 128, SERIAL_BUFSIZE);"/>
<node CREATED="1367583915004" ID="ID_85153804" MODIFIED="1367583989222" TEXT="&#x5c06;UARTA&#x4f5c;&#x4e3a;&#x63a5;&#x53e3;&#xff0c;&#x521d;&#x59cb;&#x5316;&#x5730;&#x9762;&#x7ad9;&#x901a;&#x8baf;&#x63a5;&#x53e3;GCS0&#xff1a;"/>
<node CREATED="1367584002862" ID="ID_331666653" MODIFIED="1367584004624" TEXT="gcs0.init(hal.uartA); "/>
<node CREATED="1367584049692" ID="ID_715389219" MODIFIED="1367584126995" TEXT="&#x5982;&#x679c;UART0&#x4f5c;&#x4e3a;USB&#x6210;&#x529f;&#xff0c;&#x5219;UART3&#x4f5c;&#x4e3a;&#x6570;&#x4f20;&#x63a5;&#x53e3;&#xff0c;&#x82e5;&#x4e0d;&#x6210;&#x529f;&#xff0c;&#x5219;&#x91cd;&#x65b0;&#x521d;&#x59cb;&#x5316;&#x4e3a;&#x6570;&#x4f20;&#x63a5;&#x53e3;"/>
<node CREATED="1367584128705" ID="ID_234767014" MODIFIED="1367584139079" TEXT="#if USB_MUX_PIN &gt; 0&#xa;    if (!usb_connected) {&#xa;        // we are not connected via USB, re-init UART0 with right&#xa;        // baud rate&#xa;        hal.uartA-&gt;begin(map_baudrate(g.serial3_baud, SERIAL3_BAUD));&#xa;    }&#xa;#else&#xa;    // we have a 2nd serial port for telemetry&#xa;    hal.uartC-&gt;begin(map_baudrate(g.serial3_baud, SERIAL3_BAUD),&#xa;            128, SERIAL_BUFSIZE);&#xa;    gcs3.init(hal.uartC);&#xa;#endif&#xa;"/>
<node CREATED="1367584166489" ID="ID_1796396386" MODIFIED="1367584222631" TEXT="&#x5c06;UART1&#x4f5c;&#x4e3a;&#x63a5;&#x53e3;&#xff0c;&#x521d;&#x59cb;&#x5316;GPS&#x63a5;&#x53e3;&#xff1a;"/>
<node CREATED="1367584231202" ID="ID_799184375" MODIFIED="1367584233390" TEXT="    hal.uartB-&gt;begin(38400, 256, 16); "/>
<node CREATED="1367584318514" ID="ID_51250679" MODIFIED="1367584320299" TEXT="DataFlash.Init();//Flash&#x521d;&#x59cb;&#x5316;"/>
<node CREATED="1367584367502" ID="ID_73277367" MODIFIED="1367584368853" TEXT="adc.Init();      // APM ADC library initialization"/>
<node CREATED="1367584432990" ID="ID_1295834790" MODIFIED="1367584434257" TEXT="barometer.init();//&#x6c14;&#x538b;&#x8ba1;&#x521d;&#x59cb;&#x5316;"/>
<node CREATED="1367584490350" ID="ID_334882944" MODIFIED="1367584510177" TEXT="if (!compass.init() || !compass.read()) //&#x78c1;&#x4f20;&#x611f;&#x5668;&#x521d;&#x59cb;&#x5316;"/>
<node CREATED="1367584577988" ID="ID_1224156640" MODIFIED="1367584583119" TEXT="   // &#x8f74;&#x63a7;&#x5236;&#x5668;&#x521d;&#x59cb;&#x5316;&#xa;    // the axis controllers need access to the AHRS system&#xa;    g.rollController.set_ahrs(&amp;ahrs);&#xa;    g.pitchController.set_ahrs(&amp;ahrs);&#xa;    g.yawController.set_ahrs(&amp;ahrs);&#xa;"/>
<node CREATED="1367584642872" ID="ID_907010594" MODIFIED="1367584647705" TEXT="    // GPS&#x521d;&#x59cb;&#x5316;&#xa;    // Do GPS init&#xa;       g_gps = &amp;g_gps_driver;&#xa;    // GPS Initialization&#xa;    g_gps-&gt;init(hal.uartB, GPS::GPS_ENGINE_AIRBORNE_4G);&#xa;"/>
<node CREATED="1367584726978" ID="ID_1332261637" MODIFIED="1367584731393" TEXT="    init_rc_in();               // sets up rc channels from radio &#x65e0;&#x7ebf;&#x7535;&#x63a5;&#x6536;&#x53e3;&#x521d;&#x59cb;&#x5316;&#xa;    init_rc_out();              // sets up the timer libs PWM&#x8f93;&#x51fa;&#x521d;&#x59cb;&#x5316;&#xa;"/>
<node CREATED="1367584787229" ID="ID_1588335200" MODIFIED="1367584860189" TEXT="// &#x60ef;&#x6027;&#x5355;&#x5143;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x4ee5;&#x5b8c;&#x6210;AHRS&#x7684;&#x521d;&#x59cb;&#x5316;        &#xa;ins.init(AP_InertialSensor::WARM_START,ins_sample_rate,flash_leds);&#xa;ahrs.init();&#xa;"/>
</node>
</node>
</map>
